# RS232原理與驅動程序

***本質上就是USART***<br>
***將TTR電平轉換為RS232的電平，這樣傳輸的距離與抗干擾能力更遠更強***


## 前置工作

* 將RS232的跳線接上
* 下方的RS485跳線斷開

  ![image](https://github.com/hamster-allen/STM32_Learn/blob/master/DAY_0212/RS232_picture/RS232%E8%B7%B3%E7%B7%9A.png)

* 開發版跳線斷開

  ![image](https://github.com/hamster-allen/STM32_Learn/blob/master/DAY_0212/RS232_picture/%E5%8F%B3%E4%B8%8A%E6%96%B9PB10_PB11%E8%B7%B3%E7%B7%9A.png)

> RS485和右上角的PB10、PB11都占用PB10和PB11<br>
> 如果不斷開會在RS232進行通訊時，造成干擾or通訊錯誤<br>

<br>

* PB10、PB11就是USART3
* PB10->STM32的發送端(TX)，連接外部設備的接收端(RX)
* PB11->STM32的接收端(RX)，連接外部設備的發送端(TX)

  ![image](https://github.com/hamster-allen/STM32_Learn/blob/master/DAY_0212/RS232_picture/PB10_PB11%E7%AD%89%E6%96%BCUSART3.png)

  ![image](https://github.com/hamster-allen/STM32_Learn/blob/master/DAY_0212/RS232_picture/PB10_PB11%E6%8E%A5%E5%88%B0PC_RXD_PCTXD.png)


* USART3透過跳線(P13)連接至電平轉換晶片(SP3232)
* SP3232是專門用於RS232電平轉換，可以將TTRL的電平轉換為RS232的標準電平

  ![image](https://github.com/hamster-allen/STM32_Learn/blob/master/DAY_0212/RS232_picture/3-RS232%E6%8E%A5%E5%8F%A3.png)

* 周遭連接許多電容都是根據官方給出的資料連接的(SP32322第7頁)
  
  ![image](https://github.com/hamster-allen/STM32_Learn/blob/master/DAY_0212/RS232_picture/SP3232_Datasheet_P7.png)


# 程序


```
while(1)
{
  if(!GPIO_ReadInputDataBit(TOUCH_KEYPORT,TOUCH_KEY_A))          //當觸摸按鍵被按下時，使用USART3發送出資料
  {                                                              //發送後，在OLED上顯示發送的資料
    USART3_printf("%c",'A');
    OLED_DISPLAY_8x16(6,4*8,'A');
  }
  else if(!GPIO_ReadInputDataBit(TOUCH_KEYPORT,TOUCH_KEY_B))
  {
    USART3_printf("%c",'B');
    OLED_DISPLAY_8x16(6,4*8,'B');
  }	
  else if(!GPIO_ReadInputDataBit(TOUCH_KEYPORT,TOUCH_KEY_C))
  {
    USART3_printf("%c",'C');
    OLED_DISPLAY_8x16(6,4*8,'C');
  }
  else if(!GPIO_ReadInputDataBit(TOUCH_KEYPORT,TOUCH_KEY_D))
  {
    USART3_printf("%c",'D');
    OLED_DISPLAY_8x16(6,4*8,'D');
  }

  //接收
  if(USART_GetFlagStatus(USART3,USART_FLAG_RXNE) != RESET)      //取得USART3待處理的旗標
  {
    a = USART_ReceiveData(USART3);                              //取得接收資料
    OLED_DISPLAY_8x16(6,11*8,a);                                //在OLED上顯示
  }
}
```
































